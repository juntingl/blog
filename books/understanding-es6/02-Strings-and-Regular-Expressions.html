<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>字符串和正则表达式 | 修</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="一步一步，似魔鬼的步伐">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.f7bcb8c9.js" as="script"><link rel="preload" href="/assets/js/2.b89c4e79.js" as="script"><link rel="preload" href="/assets/js/13.4522ab67.js" as="script"><link rel="prefetch" href="/assets/js/10.24a941b1.js"><link rel="prefetch" href="/assets/js/11.30aaaa71.js"><link rel="prefetch" href="/assets/js/12.2582dcda.js"><link rel="prefetch" href="/assets/js/14.27990b61.js"><link rel="prefetch" href="/assets/js/15.fd3c7806.js"><link rel="prefetch" href="/assets/js/16.edbf5f9f.js"><link rel="prefetch" href="/assets/js/17.225c6e08.js"><link rel="prefetch" href="/assets/js/18.16f89439.js"><link rel="prefetch" href="/assets/js/19.61eff3e0.js"><link rel="prefetch" href="/assets/js/20.a6fd5051.js"><link rel="prefetch" href="/assets/js/21.f4741d85.js"><link rel="prefetch" href="/assets/js/22.a994652e.js"><link rel="prefetch" href="/assets/js/23.8d6f0121.js"><link rel="prefetch" href="/assets/js/24.dcf13a19.js"><link rel="prefetch" href="/assets/js/25.41985cd5.js"><link rel="prefetch" href="/assets/js/26.6d112ccd.js"><link rel="prefetch" href="/assets/js/27.4ab4c8d0.js"><link rel="prefetch" href="/assets/js/28.4357cd0c.js"><link rel="prefetch" href="/assets/js/29.aa1e3cad.js"><link rel="prefetch" href="/assets/js/3.2e436023.js"><link rel="prefetch" href="/assets/js/4.74e889c3.js"><link rel="prefetch" href="/assets/js/5.9fcf5c5a.js"><link rel="prefetch" href="/assets/js/6.726f95eb.js"><link rel="prefetch" href="/assets/js/7.550faec2.js"><link rel="prefetch" href="/assets/js/8.fc07362b.js"><link rel="prefetch" href="/assets/js/9.69befef4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">修</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/books/" class="nav-link router-link-active">
  书
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="旅途" class="dropdown-title"><span class="title">旅途</span> <span class="arrow down"></span></button> <button type="button" aria-label="旅途" class="mobile-dropdown-title"><span class="title">旅途</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-record/" class="nav-link">
  每日记录
</a></li><li class="dropdown-item"><!----> <a href="/fitness/" class="nav-link">
  健身&amp;营养学
</a></li><li class="dropdown-item"><!----> <a href="/movie-perception/" class="nav-link">
  观影有感
</a></li><li class="dropdown-item"><!----> <a href="/anime/" class="nav-link">
  动漫
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about-me/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="https://juntingliu.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JuntingLiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/books/" class="nav-link router-link-active">
  书
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="旅途" class="dropdown-title"><span class="title">旅途</span> <span class="arrow down"></span></button> <button type="button" aria-label="旅途" class="mobile-dropdown-title"><span class="title">旅途</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-record/" class="nav-link">
  每日记录
</a></li><li class="dropdown-item"><!----> <a href="/fitness/" class="nav-link">
  健身&amp;营养学
</a></li><li class="dropdown-item"><!----> <a href="/movie-perception/" class="nav-link">
  观影有感
</a></li><li class="dropdown-item"><!----> <a href="/anime/" class="nav-link">
  动漫
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about-me/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="https://juntingliu.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JuntingLiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/books/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>深入理解 ES6</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/understanding-es6/01-Block-Bindings.html" class="sidebar-link">块级作用域绑定</a></li><li><a href="/books/understanding-es6/02-Strings-and-Regular-Expressions.html" aria-current="page" class="active sidebar-link">字符串和正则表达式</a></li><li><a href="/books/understanding-es6/03-Functions.html" class="sidebar-link">函数</a></li><li><a href="/books/understanding-es6/04-Objects.html" class="sidebar-link">扩展对象的功能性</a></li><li><a href="/books/understanding-es6/05-Destructuring.html" class="sidebar-link">解构：使数据访问更便捷</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="字符串和正则表达式"><a href="#字符串和正则表达式" class="header-anchor">#</a> 字符串和正则表达式</h1> <h2 id="更好的-unicode-支持"><a href="#更好的-unicode-支持" class="header-anchor">#</a> 更好的 Unicode 支持</h2> <p>在 <code>ESCMAScript 6</code> 之前，<code>JavaScript</code> 字符串一直基于 16 位字符编码（UTF - 16） 进行构建。每 16 位的序列是一个编码单元（code unit），代表一个字符。过去 16 位足以包含任何字符，直到 Unicode 引入扩展字符集，编码规则才不得不进行更改。</p> <h3 id="utf-16-码位"><a href="#utf-16-码位" class="header-anchor">#</a> UTF-16 码位</h3> <p><code>Unicode</code> 的目标是为全世界每一个字符提供全球唯一标识符。&quot;全球唯一的标识符” 也被称作<strong>码位</strong> （code point），是从 0 开始的数值。而表示字符的这些数值和码位，我们称之为字符编码 （character encode）。字符编码必须将码位编码为内部一致的编码单元。对 UTF - 16 来说，码位可以由多种编码单元表示。</p> <p>在 <code>UTF-16</code> 中，前 <code>2^16</code> 个码位均以 16 位的编码单元表示，这个范围被称作<strong>基本多文种平面（BMP，Basic Multilingual Plane）</strong> 。超出这个范围的码位则要归属于某个辅助平面（supplementary plane）, 其中的码位仅用 16 位就无法表示了。为此，<code>UTF-16</code> 引入了<strong>代理对（surrogate pair）</strong>，其规定用两个 16 位编码单元表示一个码位。也就是说，<strong>字符串里的字符有两种，一种是由一个编码单元 16 位表示的 BMP（基本多文种平面）字符，另一种是由两个编码单元 32 位表示的辅助平面字符</strong>。</p> <h4 id="ecmascript5-中对-utf16-编码字符的处理"><a href="#ecmascript5-中对-utf16-编码字符的处理" class="header-anchor">#</a> ECMAScript5 中对 UTF16 编码字符的处理</h4> <p>在 <code>ECMAScript5</code> 中，所有字符串的操作都是基于 16 位编码单元。如果采用同样的方式处理包含代理的 <code>UTF-16</code> 编码字符，得到的结果可能与预期不符：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'𠮷'</span><span class="token punctuation">;</span> <span class="token comment">// 不知道什么字, 日文字符</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>lengtt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2,由2个编码单元 32 位标示</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false, 匹配任意一个字符</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;, 返回字符串中的指定字符</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 55362</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tezt<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 57271</span>

</code></pre></div><blockquote><p>String.prototype.charCodeAt() 返回 0 到 65535 之间的整数，表示给定索引处的 UTF-16 代码单元  1、在 Unicode 编码单元表示一个单一的 UTF-16 编码单元的情况下，UTF-16 编码单元匹配 Unicode 编码单元。</p> <p>2、但在——例如 Unicode 编码单元 &gt; 0x10000 的这种——不能被一个 UTF-16 编码单元单独表示的情况下，只能匹配 Unicode 代理的第一个编码单元。</p> <p>3、</p></blockquote> <p>Unicode 字符“𠮷” 是通过代理对来表示的，JavaScript 字符串操作将其视为两个 16 位字符。这就意味着：</p> <ul><li><p>变量 text 的长度事实上是1，但它的 <code>length</code> 属性值却为 2。</p></li> <li><p>变量 text 被判定为两个字符，因此匹配单一字符的正则表达式会失效。</p> <ul><li><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.{2}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div></li></ul></li> <li><p>前后两个 16 位的编码单元都不表示任何可打印的字符，因此 <code>charAt()</code> 方法不会返回合法的字符串。</p></li> <li><p><code>charCodeAt()</code> 方法同样不能正确地识别地识别字符。它会返回每个 16 位编码单元对应的数值，在 ECMACScript 5 中，这已经是你可以得到的最接近 text 真实值的结果了。</p></li></ul> <h3 id="codepointat-方法"><a href="#codepointat-方法" class="header-anchor">#</a> codePointAt() 方法</h3> <p><code>ECMAScript 6</code> 新增加了完全支持 UTF-16 的 <code>codePointAt()</code>  方法，这个方法接受<strong>编码单元的位置而非字符位置作为参数</strong>，返回与字符串中给定位置对应的码位，即一个整数值。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'𠮷a'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 55362</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 57271</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 97</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 134071 完整的码位，即使这个码位包含多个编码单元</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 57271</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 97</span>
</code></pre></div><p>对于 BMP 字符集中的字符，<code>codePointAt()</code> 方法的返回值与 <code>charCodeAt()</code> 方法相同，而对于非 BMP 字符集来说返回值则不同。</p> <p><strong>检测一个字符占用的编码单元数量函数</strong></p> <p>Unicode 只有两种情况：</p> <ol><li><p>16位字符编码</p></li> <li><p>32位字符编码</p></li></ol> <p>所以构建这个函数只需要调用字符的 <code>codePointAt()</code> 方法，获取当前字符的 Unicode 码，然后判断是否超出边界值：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">is32Bit</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">is32Bit</span><span class="token punctuation">(</span><span class="token string">'𠮷'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">is32Bit</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>用 16 位表示的字符集上界为十六进制 <code>FFFF</code> , 所有超过这个上界的码位一定由两个编码单元来表示，总共有 32 位。</p> <h3 id="string-fromcodepoint-方法"><a href="#string-fromcodepoint-方法" class="header-anchor">#</a> String.fromCodePoint() 方法</h3> <p>根据指定的码位生成一个字符。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'𠮷'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '𠮷'</span>
</code></pre></div><p>此方法可以看成是更完整版的 <code>String.formCharCode()</code> 。同样，对于 <code>BMP</code> 中的所有字符，这两个方法的执行结果都相同。只有传递非 BMP 的码位作为参数时，二者执行结果才有可能不同。</p> <h3 id="normaliza-方法-es6"><a href="#normaliza-方法-es6" class="header-anchor">#</a> normaliza() 方法 （ES6）</h3> <p>ECMAScript 6 为字符串新增了一个 <code>normaliza()</code> 方法，它可以提供 <code>Unicode</code> 的标准化形式。因为 <code>Unicode</code> 有一个有趣的之处是 &quot;<strong>对不同的字符进行排序或比较操作会存在一种可能，它们是等效的。</strong>&quot;</p> <p>有两种方式定义这种关系：</p> <ol><li>规范的等效是指无论从哪个角度来看，两个序列的码位都是没有区别的；</li> <li>兼容性，两个互相兼容的码位序列看起来不同，但是在特定的情况下它们被互相交换作用使用。例如：字符  &quot;æ&quot; 和含两个字符的字符串 &quot;ae&quot; 可以互换使用，但严格来讲他们不是等效的，需要通过某些方法把这种等效关系标准化。(有待思考🤔)</li></ol> <h4 id="unicode-标准化形式"><a href="#unicode-标准化形式" class="header-anchor">#</a> Unicode 标准化形式</h4> <ul><li>以标准等价方式分解，然后以标准等价方式重组（&quot;NFC&quot;）,默认选项。</li> <li>以标准等价方式分解（&quot;NFD&quot;）</li> <li>以兼容等价方式分解（&quot;NFKC&quot;）kp</li> <li>以兼容等价方式分解，然后以标准等价方式重组（&quot;NFKD&quot;）</li></ul> <blockquote><p>重点：总之对比字符串之前，一定先把它们标准化为同一种形式。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 排序先将 values 数组里的所有字符串统一标准化（NFC）</span>
<span class="token keyword">const</span> normalized <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">.</span><span class="token function">noramize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 其他标准化形式 value.normalize('NFD')</span>
<span class="token comment">// 排序</span>
normalized<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="正则表达式-u-修饰符"><a href="#正则表达式-u-修饰符" class="header-anchor">#</a> 正则表达式 u 修饰符</h3> <p>正则表达式对字符串的操作默认将字符串的每个字符按照 16 位编码单元处理。对于超出 16 位编码单元（BMP）的 32 位 <strong>辅助平面字符</strong>，ECMAScript 6 给正则表达式定义了一个支持 Unicode 的 <code>u</code> 修饰符。</p> <h4 id="u-修饰符实例"><a href="#u-修饰符实例" class="header-anchor">#</a> u 修饰符实例</h4> <p>正则表达式添加了 <code>u</code> 修饰符时，它就从<strong>编码单元操作模式</strong>转换成<strong>字符模式</strong>。正则表达式就不会以 2 个编码单元（<strong>代理对</strong>）处理方式视为 2 个字符。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'𠮷'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false, 正则匹配一个任意字符，按照默认 text 是2个字符</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h4 id="计算码位数量"><a href="#计算码位数量" class="header-anchor">#</a> 计算码位数量</h4> <p>ECMAScript 6 目前不支持字符串码位数量的检测（length 属性还是返回字符串编码单元的数量），但是可以通过正则表达式的支持的新修饰符 <code>u</code> 来解决这个问题。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">codePointLength</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\s\S]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gu</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配空白和非空白字符 （换行、制表符、空格等）</span>
  <span class="token keyword">return</span> result <span class="token operator">?</span> result<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'𠮷'</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">codePointLength</span><span class="token punctuation">(</span><span class="token string">'𠮷'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><blockquote><p>\s : 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \f\n\r\t\v]。注意 Unicode 正则表达式会匹配全角空格符。</p> <p>\S : 匹配任何非空白字符。等价于 [^ \f\n\r\t\v]。</p> <p>注意：此方法在统计长字符串中的码位数量时，运行效率很低，可以使用字符串迭代器解决效率低的问题。</p></blockquote> <h4 id="检测-u-修饰符支持-polyfill"><a href="#检测-u-修饰符支持-polyfill" class="header-anchor">#</a> 检测 u 修饰符支持 （Polyfill）</h4> <p>兼容不支持 ES6 的 JavaScript 引擎。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">hasRegExpU</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>利用 <code>RegExp</code> 构造函数并传入 <code>u</code>  字符串作为参数，老式浏览器引擎支持这个语法，但是如果不支持 <code>u</code> 修饰符会抛出错误。</p> <h3 id="字符串扩展方法-es6"><a href="#字符串扩展方法-es6" class="header-anchor">#</a> 字符串扩展方法（ES6）</h3> <h4 id="字符串中的子串识别"><a href="#字符串中的子串识别" class="header-anchor">#</a> 字符串中的子串识别</h4> <ul><li><code>includes()</code> 方法，如果在字符串中检测到指定文本则返回 <code>true</code> ，否则返回 <code>false</code> 。</li> <li><code>startsWith()</code> 方法， 如果在字符串的起始部分检测到指定的文本则返回 <code>true</code>, 否则返回 <code>false</code> 。</li> <li><code>endsWith()</code> 方法，如果在字符串的结束部分检测到指定文本则返回 <code>true</code>, 否则返回 <code>false</code>。</li></ul> <p>以上 3 个方法都接受两个参数：第一个参数指定要搜索的文本；第二个参数是可选的，指定一个开始搜索位置的索引值。默认是从起始位置开始匹配。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'lo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'He'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'wo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'d!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'~'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">starsWith</span><span class="token punctuation">(</span><span class="token string">'wo'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p>⚠️ 注意：</p> <p><code>includes()</code>、 <code>startsWith()</code>、<code>endsWith()</code> 这 3 个方法，第一个参数必须是字符串，否则会产生报错。</p> <p><code>indexOf()</code>、 <code>lastIndexOf()</code> 方法传递第一个参数为正则表达式，则会转化为一个字符串并搜索它。</p></blockquote> <h4 id="repeat-方法"><a href="#repeat-方法" class="header-anchor">#</a> repeat() 方法</h4> <p>功能就是字面意思 &quot;重复&quot;，接收一个 number 类型的参数，表示该字符串的重复次数，返回值是当前字符串重复一定次数后的新字符串。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'money '</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// money money money money money money</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'six '</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// six six six six six six</span>
</code></pre></div><h3 id="其他正则表达式语法变更-es6"><a href="#其他正则表达式语法变更-es6" class="header-anchor">#</a> 其他正则表达式语法变更 （ES6）</h3> <h4 id="正则表达式-y-修饰符"><a href="#正则表达式-y-修饰符" class="header-anchor">#</a> 正则表达式 y 修饰符</h4> <p><code>y</code> 修饰符是 ECMAScript 6 成为正则表达式的一个专有扩展。当字符串中开始字符匹配时，它会通知搜索从正则表达式的 <code>lastIndex</code> 属性开始进行，如果在指定的位置没能成功匹配，则停止继续匹配。</p> <p><code>y</code> 修饰符 和 <code>g</code> 修饰符功能类似，都是全局匹配，后一次匹配都从上一次匹配成功的 <code>lastIndex</code> 开始。不同之处在于，<code>g</code>修饰符只要剩余位置中存在匹配就可，而 <code>y</code> 修饰符确保匹配必须从剩余的第一个位置开始，会影响正则表达式搜索过程中的 <code>sticky</code> (粘滞) 属性。</p> <p><strong>示例</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'hello1 hello2 hello3'</span><span class="token punctuation">,</span>
  pattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d\s?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
  globalPattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d\s?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token comment">// g 修饰符</span>
  globalResult <span class="token operator">=</span> globalPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
  stickyPattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d\s?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">,</span> <span class="token comment">// y 修饰符</span>
  stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 匹配值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello1 &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello1 &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello1 &quot;</span>

<span class="token comment">// exec 执行一次正则匹配后，正则表达式的 lastIndex 属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>

<span class="token comment">// 手动修改下正则表达式的 lastIndex 属性，测试一下 sticky 属性影响</span>
<span class="token comment">// lastIndex 为 1，所以从第二个字符 “e” 开始匹配</span>
pattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 没有修饰符，每次匹配都是从头开始，lastIndex 直接被忽略</span>
globalPattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
stickyPattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalResult <span class="token operator">=</span> globalPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用了 y 修饰符的粘滞</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello1 &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello2 &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出错误： Cannot read property '0' of null</span>

<span class="token comment">// 报错中断后，再次的执行下面代码</span>
stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello1 &quot;</span>
</code></pre></div><p><code>y</code> 修饰符会把上次匹配后面一个字符的索引保存在 <code>lastIndex</code> 中；如果该操作匹配的结果为空，则 <code>lastIndex</code> 会被重置为 <code>0</code> 。<code>g</code> 修饰符的行为与此相同。</p> <h5 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h5> <p><strong>y 修饰符</strong></p> <ol><li>只有调用 <code>exec()</code> 和 <code>test()</code> 这些正则表达式对象的方法时才会涉及 <code>lastIndex</code> 属性；调用字符串的方法，例如 <code>macth()</code> 则不会触发粘滞行为。</li> <li>对于粘滞正则表达式而言，如果使用 <code>^</code> 字符 来匹配字符串开端，只会从字符串的起始位置或多行模式的首行进行匹配。当 <code>lastIndex</code> 的值为 0 时，如果正则表达式中含有 <code>^</code> ，则是否使用粘滞正则表达式并无差别；如果 <code>lastIndex</code> 的值在单行模式下不为 0，或在多行模式下不对应行首，则粘滞的表达式永远不会匹配成功。</li></ol> <h5 id="检测-y-修饰符是否存在"><a href="#检测-y-修饰符是否存在" class="header-anchor">#</a> 检测 y 修饰符是否存在</h5> <p>通过属性名来进行检测， 检测正则表达式 <code>sticky</code>  粘滞属性是否支持。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>sticky<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>如果浏览器引擎支持粘滞修饰符，则 <code>sticky</code> 属性值为 <code>true</code>, 否则为 <code>false</code>。这个是只读属性。</p> <h5 id="检测引擎对它的支持程度"><a href="#检测引擎对它的支持程度" class="header-anchor">#</a> 检测引擎对它的支持程度</h5> <p>检测浏览器引擎对 <code>y</code> 修饰符和  <code>u</code> 修饰符的支持程度，两种方式都是通过 <code>RegExp</code> 构造函数来进行（规避语法错误）：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">hasRegExpY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> parrent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="正则表达式的复制"><a href="#正则表达式的复制" class="header-anchor">#</a> 正则表达式的复制</h4> <p>对于正则表达式的复制，就是通过 <code>RegExp</code> 的构造函数传递正则表达式作为参数来复制这个正则表达式。</p> <p>这种方式的复制在 <code>ECMAScript 5</code> 和 <code>ECMAScript 6</code> 有一个区别：</p> <ul><li>在 <code>ECMAScript 5</code> 传递第一个参数为正则表达式时，不能传递第二个参数为正则表达式指定一个修饰符，否则会抛出一个错误</li> <li><code>ECMAScript 6</code> 环境下，正常运行，也支持了传递第一个参数为正则表达式时，也可以传递第二个参数指定修饰符。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 复制方式</span>
<span class="token keyword">var</span> re1 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">ab</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    re2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>re1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ES5 中会抛出错误, ES6 支持</span>
re3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>re1<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re3<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;/ab/g&quot;</span>
</code></pre></div><h4 id="flags-属性-es6"><a href="#flags-属性-es6" class="header-anchor">#</a> flags 属性（ES6）</h4> <p>获取正则表达式的修饰符。</p> <p>ES5 的时候获取正则表达式修饰，只能通过 <code>toString</code> 的方法来进行：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getFlags</span> <span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> text <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方式二（替换截取方法）</span>
<span class="token keyword">function</span> <span class="token function">getFlags</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> text <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token comment">// &quot;hello\d&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getFlags</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;y&quot;</span>
</code></pre></div><p>ES6 新增 <strong>flags</strong> 属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello\d</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>flags<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;y&quot;</span>
</code></pre></div><h3 id="模板字符串-模板字面量"><a href="#模板字符串-模板字面量" class="header-anchor">#</a> 模板字符串（模板字面量）</h3> <p><strong>ECMAScript 6</strong> 模板字面量语法糖支持创建领域专用语言（DSL）,扩展 <code>ECMAScript</code> 基础语法糖，其提供一套生成、查询并操作来自其他语言里内容的 DSL，且可以免受注入攻击，例如，XSS、SQL 注入等。</p> <blockquote><p><strong>领域特定语言</strong>（英语：domain-specific language、DSL）</p> <p>指的是专注于某个<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/5985445" target="_blank" rel="noopener noreferrer">应用程序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>领域的<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/4456504" target="_blank" rel="noopener noreferrer">计算机语言<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。又译作<strong>领域专用语言</strong>。不同于普通的跨领域通用计算机语言(GPL)，领域特定语言只用在某些特定的领域。 比如用来显示网页的<a href="https://baike.baidu.com/item/HTML" target="_blank" rel="noopener noreferrer">HTML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，以及<a href="https://baike.baidu.com/item/Emacs" target="_blank" rel="noopener noreferrer">Emacs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>所使用的Emac LISP语言。</p></blockquote> <p>相对于 <strong>ECMAScript 5</strong> ，模板字面量支持了：</p> <ul><li>多行字符串</li> <li>基本的字符串格式化 （将变量的值嵌入字符串的能力）</li> <li>HTML 转义</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Junting</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token string">'Liu'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My first name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,
last name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// My first name is Junting,</span>
<span class="token comment">// last name is Liu.</span>
</code></pre></div><h4 id="标签模板"><a href="#标签模板" class="header-anchor">#</a> 标签模板</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> message <span class="token operator">=</span> tag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello world!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p><code>tag</code> 就是标签模板里的<strong>模板标签</strong>。每个模板标签都可以执行模板字面量上的转换并返回最终的字符串。</p> <p>标签可以是一个函数，调用时传入加工过的模板字面量各个部分数据，但必须结合每个部分来创建结果。</p> <ul><li>第一参数是一个数组，包含 Javascript 解释过后的字面量字符串</li> <li>后面的每一个参数都是每一个占位符的解释值。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">tag</span> <span class="token punctuation">(</span><span class="token parameter">literals<span class="token punctuation">,</span> <span class="token operator">...</span>substitutions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回一个字符串</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>literals</strong> 第一个参数永远是一个空字符串，确保字符串始端。</p> <p><strong>substitutions</strong> 参数的数量永远也比 <strong>literals</strong> 少一个。<code>substitutions.length === literals.length - 1</code> 结果总为 <code>true</code></p></blockquote> <p><strong>示例：实现一个简单的模板字面量转换默认行为的函数</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
      price <span class="token operator">=</span> <span class="token number">2.5</span><span class="token punctuation">,</span>
      message <span class="token operator">=</span> passthru<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items cost $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>count <span class="token operator">*</span> price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">passthru</span> <span class="token punctuation">(</span><span class="token parameter">literals<span class="token punctuation">,</span> <span class="token operator">...</span>substitutions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>literals<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;&quot;, &quot; items cost $&quot;, &quot;.&quot;, raw: Array(3)]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>substitutions<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [10, &quot;25.00&quot;]</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> substitutions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">+=</span> literals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    result <span class="token operator">+=</span> substitutions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  result <span class="token operator">+=</span> literals<span class="token punctuation">[</span>literals<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;10 items cost $25.00.&quot;</span>
</code></pre></div><p>标签模板的标签( Tag ) 的职责就是处理字符串最后怎样返回结果，由标签来定。</p> <h4 id="获取模板字面量的原始值"><a href="#获取模板字面量的原始值" class="header-anchor">#</a> 获取模板字面量的原始值</h4> <p><code>String.raw()</code> 提取原生字符串信息，提取转义或转换前的原生字符串。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> message1 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Multiline\nstring</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    message2 <span class="token operator">=</span> String<span class="token punctuation">.</span>raw<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Multiline\nstring</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Multiline&quot;</span>
											 <span class="token comment">// &quot;string&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Multiline\nstring&quot; (Browser)</span>
											 <span class="token comment">// &quot;Multiline\\nstring&quot; (Node)</span>
</code></pre></div><blockquote><p>上个示例中，标签函数的第一个参数数组还有一个额外的属性 <strong>raw</strong>, 是一个包含每一个字面值的原生等价信息的数组。</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/21/2022, 10:13:10 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/books/understanding-es6/01-Block-Bindings.html" class="prev">
        块级作用域绑定
      </a></span> <span class="next"><a href="/books/understanding-es6/03-Functions.html">
        函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f7bcb8c9.js" defer></script><script src="/assets/js/2.b89c4e79.js" defer></script><script src="/assets/js/13.4522ab67.js" defer></script>
  </body>
</html>
