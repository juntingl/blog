# å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼

## æ›´å¥½çš„ Unicode æ”¯æŒ

åœ¨ `ESCMAScript 6` ä¹‹å‰ï¼Œ`JavaScript` å­—ç¬¦ä¸²ä¸€ç›´åŸºäº 16 ä½å­—ç¬¦ç¼–ç ï¼ˆUTF - 16ï¼‰ è¿›è¡Œæ„å»ºã€‚æ¯ 16 ä½çš„åºåˆ—æ˜¯ä¸€ä¸ªç¼–ç å•å…ƒï¼ˆcode unitï¼‰ï¼Œä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚è¿‡å» 16 ä½è¶³ä»¥åŒ…å«ä»»ä½•å­—ç¬¦ï¼Œç›´åˆ° Unicode å¼•å…¥æ‰©å±•å­—ç¬¦é›†ï¼Œç¼–ç è§„åˆ™æ‰ä¸å¾—ä¸è¿›è¡Œæ›´æ”¹ã€‚

### UTF-16 ç ä½

`Unicode ` çš„ç›®æ ‡æ˜¯ä¸ºå…¨ä¸–ç•Œæ¯ä¸€ä¸ªå­—ç¬¦æä¾›å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦ã€‚"å…¨çƒå”¯ä¸€çš„æ ‡è¯†ç¬¦â€ ä¹Ÿè¢«ç§°ä½œ**ç ä½** ï¼ˆcode pointï¼‰ï¼Œæ˜¯ä» 0 å¼€å§‹çš„æ•°å€¼ã€‚è€Œè¡¨ç¤ºå­—ç¬¦çš„è¿™äº›æ•°å€¼å’Œç ä½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå­—ç¬¦ç¼–ç  ï¼ˆcharacter encodeï¼‰ã€‚å­—ç¬¦ç¼–ç å¿…é¡»å°†ç ä½ç¼–ç ä¸ºå†…éƒ¨ä¸€è‡´çš„ç¼–ç å•å…ƒã€‚å¯¹ UTF - 16 æ¥è¯´ï¼Œç ä½å¯ä»¥ç”±å¤šç§ç¼–ç å•å…ƒè¡¨ç¤ºã€‚

åœ¨ `UTF-16` ä¸­ï¼Œå‰ `2^16` ä¸ªç ä½å‡ä»¥ 16 ä½çš„ç¼–ç å•å…ƒè¡¨ç¤ºï¼Œè¿™ä¸ªèŒƒå›´è¢«ç§°ä½œ**åŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMPï¼ŒBasic Multilingual Planeï¼‰** ã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„ç ä½åˆ™è¦å½’å±äºæŸä¸ªè¾…åŠ©å¹³é¢ï¼ˆsupplementary planeï¼‰, å…¶ä¸­çš„ç ä½ä»…ç”¨ 16 ä½å°±æ— æ³•è¡¨ç¤ºäº†ã€‚ä¸ºæ­¤ï¼Œ`UTF-16 ` å¼•å…¥äº†**ä»£ç†å¯¹ï¼ˆsurrogate pairï¼‰**ï¼Œå…¶è§„å®šç”¨ä¸¤ä¸ª 16 ä½ç¼–ç å•å…ƒè¡¨ç¤ºä¸€ä¸ªç ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç”±ä¸€ä¸ªç¼–ç å•å…ƒ 16 ä½è¡¨ç¤ºçš„ BMPï¼ˆåŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼‰å­—ç¬¦ï¼Œå¦ä¸€ç§æ˜¯ç”±ä¸¤ä¸ªç¼–ç å•å…ƒ 32 ä½è¡¨ç¤ºçš„è¾…åŠ©å¹³é¢å­—ç¬¦**ã€‚

#### ECMAScript5 ä¸­å¯¹ UTF16 ç¼–ç å­—ç¬¦çš„å¤„ç†

åœ¨ `ECMAScript5` ä¸­ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²çš„æ“ä½œéƒ½æ˜¯åŸºäº 16 ä½ç¼–ç å•å…ƒã€‚å¦‚æœé‡‡ç”¨åŒæ ·çš„æ–¹å¼å¤„ç†åŒ…å«ä»£ç†çš„ `UTF-16` ç¼–ç å­—ç¬¦ï¼Œå¾—åˆ°çš„ç»“æœå¯èƒ½ä¸é¢„æœŸä¸ç¬¦ï¼š

```JavaScript
let text = 'ğ ®·'; // ä¸çŸ¥é“ä»€ä¹ˆå­—, æ—¥æ–‡å­—ç¬¦

console.log(text.lengtt); // 2,ç”±2ä¸ªç¼–ç å•å…ƒ 32 ä½æ ‡ç¤º
console.log(/^.$/.test(text)); //false, åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦
console.log(text.charAt(0)); // "", è¿”å›å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå­—ç¬¦
console.log(text.charAt(1)); // ""
console.log(text.charCodeAt(0)); // 55362
console.log(tezt.charCodeAt(1)); // 57271

```

> String.prototype.charCodeAt() è¿”å› 0 åˆ° 65535 ä¹‹é—´çš„æ•´æ•°ï¼Œè¡¨ç¤ºç»™å®šç´¢å¼•å¤„çš„ UTF-16 ä»£ç å•å…ƒ  1ã€åœ¨ Unicode ç¼–ç å•å…ƒè¡¨ç¤ºä¸€ä¸ªå•ä¸€çš„ UTF-16 ç¼–ç å•å…ƒçš„æƒ…å†µä¸‹ï¼ŒUTF-16 ç¼–ç å•å…ƒåŒ¹é… Unicode ç¼–ç å•å…ƒã€‚
>
> 2ã€ä½†åœ¨â€”â€”ä¾‹å¦‚ Unicode ç¼–ç å•å…ƒ > 0x10000 çš„è¿™ç§â€”â€”ä¸èƒ½è¢«ä¸€ä¸ª UTF-16 ç¼–ç å•å…ƒå•ç‹¬è¡¨ç¤ºçš„æƒ…å†µä¸‹ï¼Œåªèƒ½åŒ¹é… Unicode ä»£ç†çš„ç¬¬ä¸€ä¸ªç¼–ç å•å…ƒã€‚
>
> 3ã€

Unicode å­—ç¬¦â€œğ ®·â€ æ˜¯é€šè¿‡ä»£ç†å¯¹æ¥è¡¨ç¤ºçš„ï¼ŒJavaScript å­—ç¬¦ä¸²æ“ä½œå°†å…¶è§†ä¸ºä¸¤ä¸ª 16 ä½å­—ç¬¦ã€‚è¿™å°±æ„å‘³ç€ï¼š

* å˜é‡ text çš„é•¿åº¦äº‹å®ä¸Šæ˜¯1ï¼Œä½†å®ƒçš„ `length` å±æ€§å€¼å´ä¸º 2ã€‚

* å˜é‡ text è¢«åˆ¤å®šä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå› æ­¤åŒ¹é…å•ä¸€å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå¤±æ•ˆã€‚

  * ```javascript
    /^.{2}$/.test(text); // true
    ```

* å‰åä¸¤ä¸ª 16 ä½çš„ç¼–ç å•å…ƒéƒ½ä¸è¡¨ç¤ºä»»ä½•å¯æ‰“å°çš„å­—ç¬¦ï¼Œå› æ­¤ `charAt()` æ–¹æ³•ä¸ä¼šè¿”å›åˆæ³•çš„å­—ç¬¦ä¸²ã€‚

* `charCodeAt()` æ–¹æ³•åŒæ ·ä¸èƒ½æ­£ç¡®åœ°è¯†åˆ«åœ°è¯†åˆ«å­—ç¬¦ã€‚å®ƒä¼šè¿”å›æ¯ä¸ª 16 ä½ç¼–ç å•å…ƒå¯¹åº”çš„æ•°å€¼ï¼Œåœ¨ ECMACScript 5 ä¸­ï¼Œè¿™å·²ç»æ˜¯ä½ å¯ä»¥å¾—åˆ°çš„æœ€æ¥è¿‘ text çœŸå®å€¼çš„ç»“æœäº†ã€‚

### codePointAt() æ–¹æ³•

`ECMAScript 6` æ–°å¢åŠ äº†å®Œå…¨æ”¯æŒ UTF-16 çš„ `codePointAt()`  æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—**ç¼–ç å•å…ƒçš„ä½ç½®è€Œéå­—ç¬¦ä½ç½®ä½œä¸ºå‚æ•°**ï¼Œè¿”å›ä¸å­—ç¬¦ä¸²ä¸­ç»™å®šä½ç½®å¯¹åº”çš„ç ä½ï¼Œå³ä¸€ä¸ªæ•´æ•°å€¼ã€‚

```javascript
let text = 'ğ ®·a';

console.log(text.charCodeAt(0)); // 55362
console.log(text.charCodeAt(1)); // 57271
console.log(text.charCodeAt(2)); // 97

console.log(text.codePointAt(0)); // 134071 å®Œæ•´çš„ç ä½ï¼Œå³ä½¿è¿™ä¸ªç ä½åŒ…å«å¤šä¸ªç¼–ç å•å…ƒ
console.log(text.codePointAt(1)); // 57271
console.log(text.codePointAt(2)); // 97
```

å¯¹äº BMP å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œ`codePointAt()` æ–¹æ³•çš„è¿”å›å€¼ä¸ `charCodeAt()` æ–¹æ³•ç›¸åŒï¼Œè€Œå¯¹äºé BMP å­—ç¬¦é›†æ¥è¯´è¿”å›å€¼åˆ™ä¸åŒã€‚

**æ£€æµ‹ä¸€ä¸ªå­—ç¬¦å ç”¨çš„ç¼–ç å•å…ƒæ•°é‡å‡½æ•°**

Unicode åªæœ‰ä¸¤ç§æƒ…å†µï¼š

1. 16ä½å­—ç¬¦ç¼–ç 

2. 32ä½å­—ç¬¦ç¼–ç 

æ‰€ä»¥æ„å»ºè¿™ä¸ªå‡½æ•°åªéœ€è¦è°ƒç”¨å­—ç¬¦çš„ `codePointAt()` æ–¹æ³•ï¼Œè·å–å½“å‰å­—ç¬¦çš„ Unicode ç ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦è¶…å‡ºè¾¹ç•Œå€¼ï¼š

```javascript
function is32Bit(c) {
  return c.codePointAt(0) > 0xFFFF;
}

console.log(is32Bit('ğ ®·')); // true
console.log(is32Bit('a')); // false
```

ç”¨ 16 ä½è¡¨ç¤ºçš„å­—ç¬¦é›†ä¸Šç•Œä¸ºåå…­è¿›åˆ¶ `FFFF` , æ‰€æœ‰è¶…è¿‡è¿™ä¸ªä¸Šç•Œçš„ç ä½ä¸€å®šç”±ä¸¤ä¸ªç¼–ç å•å…ƒæ¥è¡¨ç¤ºï¼Œæ€»å…±æœ‰ 32 ä½ã€‚

### String.fromCodePoint() æ–¹æ³•

æ ¹æ®æŒ‡å®šçš„ç ä½ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ã€‚

```javascript
let text = 'ğ ®·';

console.log(String.fromCodePoint(text.codePointAt(0))); // 'ğ ®·'
```

æ­¤æ–¹æ³•å¯ä»¥çœ‹æˆæ˜¯æ›´å®Œæ•´ç‰ˆçš„ `String.formCharCode()` ã€‚åŒæ ·ï¼Œå¯¹äº `BMP` ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„æ‰§è¡Œç»“æœéƒ½ç›¸åŒã€‚åªæœ‰ä¼ é€’é BMP çš„ç ä½ä½œä¸ºå‚æ•°æ—¶ï¼ŒäºŒè€…æ‰§è¡Œç»“æœæ‰æœ‰å¯èƒ½ä¸åŒã€‚

### normaliza() æ–¹æ³• ï¼ˆES6ï¼‰

ECMAScript 6 ä¸ºå­—ç¬¦ä¸²æ–°å¢äº†ä¸€ä¸ª `normaliza()` æ–¹æ³•ï¼Œå®ƒå¯ä»¥æä¾› `Unicode ` çš„æ ‡å‡†åŒ–å½¢å¼ã€‚å› ä¸º `Unicode` æœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¹‹å¤„æ˜¯ "**å¯¹ä¸åŒçš„å­—ç¬¦è¿›è¡Œæ’åºæˆ–æ¯”è¾ƒæ“ä½œä¼šå­˜åœ¨ä¸€ç§å¯èƒ½ï¼Œå®ƒä»¬æ˜¯ç­‰æ•ˆçš„ã€‚**"

æœ‰ä¸¤ç§æ–¹å¼å®šä¹‰è¿™ç§å…³ç³»ï¼š

1. è§„èŒƒçš„ç­‰æ•ˆæ˜¯æŒ‡æ— è®ºä»å“ªä¸ªè§’åº¦æ¥çœ‹ï¼Œä¸¤ä¸ªåºåˆ—çš„ç ä½éƒ½æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼›
2. å…¼å®¹æ€§ï¼Œä¸¤ä¸ªäº’ç›¸å…¼å®¹çš„ç ä½åºåˆ—çœ‹èµ·æ¥ä¸åŒï¼Œä½†æ˜¯åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹å®ƒä»¬è¢«äº’ç›¸äº¤æ¢ä½œç”¨ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦  "Ã¦" å’Œå«ä¸¤ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸² "ae" å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œä½†ä¸¥æ ¼æ¥è®²ä»–ä»¬ä¸æ˜¯ç­‰æ•ˆçš„ï¼Œéœ€è¦é€šè¿‡æŸäº›æ–¹æ³•æŠŠè¿™ç§ç­‰æ•ˆå…³ç³»æ ‡å‡†åŒ–ã€‚(æœ‰å¾…æ€è€ƒğŸ¤”)

#### Unicode æ ‡å‡†åŒ–å½¢å¼

* ä»¥æ ‡å‡†ç­‰ä»·æ–¹å¼åˆ†è§£ï¼Œç„¶åä»¥æ ‡å‡†ç­‰ä»·æ–¹å¼é‡ç»„ï¼ˆ"NFC"ï¼‰,é»˜è®¤é€‰é¡¹ã€‚
* ä»¥æ ‡å‡†ç­‰ä»·æ–¹å¼åˆ†è§£ï¼ˆ"NFD"ï¼‰
* ä»¥å…¼å®¹ç­‰ä»·æ–¹å¼åˆ†è§£ï¼ˆ"NFKC"ï¼‰kp
* ä»¥å…¼å®¹ç­‰ä»·æ–¹å¼åˆ†è§£ï¼Œç„¶åä»¥æ ‡å‡†ç­‰ä»·æ–¹å¼é‡ç»„ï¼ˆ"NFKD"ï¼‰

> é‡ç‚¹ï¼šæ€»ä¹‹å¯¹æ¯”å­—ç¬¦ä¸²ä¹‹å‰ï¼Œä¸€å®šå…ˆæŠŠå®ƒä»¬æ ‡å‡†åŒ–ä¸ºåŒä¸€ç§å½¢å¼ã€‚

```javascript
// æ’åºå…ˆå°† values æ•°ç»„é‡Œçš„æ‰€æœ‰å­—ç¬¦ä¸²ç»Ÿä¸€æ ‡å‡†åŒ–ï¼ˆNFCï¼‰
const normalized = values.map(value => value.noramize()); // å…¶ä»–æ ‡å‡†åŒ–å½¢å¼ value.normalize('NFD')
// æ’åº
normalized.sort((a, b) => a - b);
```

### æ­£åˆ™è¡¨è¾¾å¼ u ä¿®é¥°ç¬¦

æ­£åˆ™è¡¨è¾¾å¼å¯¹å­—ç¬¦ä¸²çš„æ“ä½œé»˜è®¤å°†å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦æŒ‰ç…§ 16 ä½ç¼–ç å•å…ƒå¤„ç†ã€‚å¯¹äºè¶…å‡º 16 ä½ç¼–ç å•å…ƒï¼ˆBMPï¼‰çš„ 32 ä½ **è¾…åŠ©å¹³é¢å­—ç¬¦**ï¼ŒECMAScript 6 ç»™æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰äº†ä¸€ä¸ªæ”¯æŒ Unicode çš„ `u` ä¿®é¥°ç¬¦ã€‚

#### u ä¿®é¥°ç¬¦å®ä¾‹

æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº† `u` ä¿®é¥°ç¬¦æ—¶ï¼Œå®ƒå°±ä»**ç¼–ç å•å…ƒæ“ä½œæ¨¡å¼**è½¬æ¢æˆ**å­—ç¬¦æ¨¡å¼**ã€‚æ­£åˆ™è¡¨è¾¾å¼å°±ä¸ä¼šä»¥ 2 ä¸ªç¼–ç å•å…ƒï¼ˆ**ä»£ç†å¯¹**ï¼‰å¤„ç†æ–¹å¼è§†ä¸º 2 ä¸ªå­—ç¬¦ã€‚

```javascript
let text = 'ğ ®·';

console.log(text.length); // 2
console.log(/^.$/.test(text)); // false, æ­£åˆ™åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼ŒæŒ‰ç…§é»˜è®¤ text æ˜¯2ä¸ªå­—ç¬¦
console.log(/^.$/u.test(text)); // true
```

#### è®¡ç®—ç ä½æ•°é‡

ECMAScript 6 ç›®å‰ä¸æ”¯æŒå­—ç¬¦ä¸²ç ä½æ•°é‡çš„æ£€æµ‹ï¼ˆlength å±æ€§è¿˜æ˜¯è¿”å›å­—ç¬¦ä¸²ç¼–ç å•å…ƒçš„æ•°é‡ï¼‰ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒçš„æ–°ä¿®é¥°ç¬¦ `u` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```javascript
function codePointLength(text) {
  const result = text.match(/[\s\S]/gu); // åŒ¹é…ç©ºç™½å’Œéç©ºç™½å­—ç¬¦ ï¼ˆæ¢è¡Œã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼ç­‰ï¼‰
  return result ? result.length : 0;
}

console.log('ğ ®·'.length); // 2
console.log(codePointLength('ğ ®·')); // 1
```

> \s : åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \f\n\r\t\v]ã€‚æ³¨æ„ Unicode æ­£åˆ™è¡¨è¾¾å¼ä¼šåŒ¹é…å…¨è§’ç©ºæ ¼ç¬¦ã€‚
>
> \S : åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \f\n\r\t\v]ã€‚
>
> æ³¨æ„ï¼šæ­¤æ–¹æ³•åœ¨ç»Ÿè®¡é•¿å­—ç¬¦ä¸²ä¸­çš„ç ä½æ•°é‡æ—¶ï¼Œè¿è¡Œæ•ˆç‡å¾ˆä½ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²è¿­ä»£å™¨è§£å†³æ•ˆç‡ä½çš„é—®é¢˜ã€‚

#### æ£€æµ‹ u ä¿®é¥°ç¬¦æ”¯æŒ ï¼ˆPolyfillï¼‰

å…¼å®¹ä¸æ”¯æŒ ES6 çš„ JavaScript å¼•æ“ã€‚

```javascript
function hasRegExpU() {
  try {
    var pattern = new RegExp(".", "u");
    return true;
  } catch(ex) {
    return false;
  }
}
```

åˆ©ç”¨ `RegExp` æ„é€ å‡½æ•°å¹¶ä¼ å…¥ `u`  å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè€å¼æµè§ˆå™¨å¼•æ“æ”¯æŒè¿™ä¸ªè¯­æ³•ï¼Œä½†æ˜¯å¦‚æœä¸æ”¯æŒ `u` ä¿®é¥°ç¬¦ä¼šæŠ›å‡ºé”™è¯¯ã€‚

### å­—ç¬¦ä¸²æ‰©å±•æ–¹æ³•ï¼ˆES6ï¼‰

#### å­—ç¬¦ä¸²ä¸­çš„å­ä¸²è¯†åˆ«

* `includes()` æ–¹æ³•ï¼Œå¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­æ£€æµ‹åˆ°æŒ‡å®šæ–‡æœ¬åˆ™è¿”å› `true` ï¼Œå¦åˆ™è¿”å› `false` ã€‚
* `startsWith()` æ–¹æ³•ï¼Œ å¦‚æœåœ¨å­—ç¬¦ä¸²çš„èµ·å§‹éƒ¨åˆ†æ£€æµ‹åˆ°æŒ‡å®šçš„æ–‡æœ¬åˆ™è¿”å› `true`, å¦åˆ™è¿”å› `false` ã€‚
* `endsWith()` æ–¹æ³•ï¼Œå¦‚æœåœ¨å­—ç¬¦ä¸²çš„ç»“æŸéƒ¨åˆ†æ£€æµ‹åˆ°æŒ‡å®šæ–‡æœ¬åˆ™è¿”å› `true`, å¦åˆ™è¿”å› `false`ã€‚

ä»¥ä¸Š 3 ä¸ªæ–¹æ³•éƒ½æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¦æœç´¢çš„æ–‡æœ¬ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼ŒæŒ‡å®šä¸€ä¸ªå¼€å§‹æœç´¢ä½ç½®çš„ç´¢å¼•å€¼ã€‚é»˜è®¤æ˜¯ä»èµ·å§‹ä½ç½®å¼€å§‹åŒ¹é…ã€‚

```javascript
const msg = "Hello world!";

console.log(msg.includes('lo')); // true

console.log(msg.startsWith('He')); // true
console.log(msg.startsWith('wo')); // false

console.log(msg.endsWith('d!')); // true
console.log(msg.endsWith('~')); // false

console.log(msg.starsWith('wo', 6)); // true
```

> âš ï¸ æ³¨æ„ï¼š
>
> `includes()`ã€ `startsWith()`ã€`endsWith()` è¿™ 3 ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šäº§ç”ŸæŠ¥é”™ã€‚
>
> `indexOf()`ã€ `lastIndexOf()` æ–¹æ³•ä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶æœç´¢å®ƒã€‚

#### repeat() æ–¹æ³•

åŠŸèƒ½å°±æ˜¯å­—é¢æ„æ€ "é‡å¤"ï¼Œæ¥æ”¶ä¸€ä¸ª number ç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦ä¸²çš„é‡å¤æ¬¡æ•°ï¼Œè¿”å›å€¼æ˜¯å½“å‰å­—ç¬¦ä¸²é‡å¤ä¸€å®šæ¬¡æ•°åçš„æ–°å­—ç¬¦ä¸²ã€‚

```javascript
console.log('money '.repeat(6)); // money money money money money money
console.log('six '.repeat(6)); // six six six six six six
```

### å…¶ä»–æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•å˜æ›´ ï¼ˆES6ï¼‰

#### æ­£åˆ™è¡¨è¾¾å¼ y ä¿®é¥°ç¬¦

`y` ä¿®é¥°ç¬¦æ˜¯ ECMAScript 6 æˆä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªä¸“æœ‰æ‰©å±•ã€‚å½“å­—ç¬¦ä¸²ä¸­å¼€å§‹å­—ç¬¦åŒ¹é…æ—¶ï¼Œå®ƒä¼šé€šçŸ¥æœç´¢ä»æ­£åˆ™è¡¨è¾¾å¼çš„ `lastIndex` å±æ€§å¼€å§‹è¿›è¡Œï¼Œå¦‚æœåœ¨æŒ‡å®šçš„ä½ç½®æ²¡èƒ½æˆåŠŸåŒ¹é…ï¼Œåˆ™åœæ­¢ç»§ç»­åŒ¹é…ã€‚

`y` ä¿®é¥°ç¬¦ å’Œ `g` ä¿®é¥°ç¬¦åŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½æ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ `lastIndex` å¼€å§‹ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ`g `ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œ `y` ä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œä¼šå½±å“æ­£åˆ™è¡¨è¾¾å¼æœç´¢è¿‡ç¨‹ä¸­çš„ `sticky` (ç²˜æ») å±æ€§ã€‚

**ç¤ºä¾‹**

```javascript

let text = 'hello1 hello2 hello3',
  pattern = /hello\d\s?/,
  result = pattern.exec(text),
  globalPattern = /hello\d\s?/g, // g ä¿®é¥°ç¬¦
  globalResult = globalPattern.exec(text),
  stickyPattern = /hello\d\s?/y, // y ä¿®é¥°ç¬¦
  stickyResult = stickyPattern.exec(text);

// åŒ¹é…å€¼
console.log(result[0]); // "hello1 "
console.log(globalResult[0]); // "hello1 "
console.log(stickyResult[0]); // "hello1 "

// exec æ‰§è¡Œä¸€æ¬¡æ­£åˆ™åŒ¹é…åï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„ lastIndex å±æ€§
console.log(pattern.lastIndex); // 0
console.log(globalPattern.lastIndex); // 7
console.log(stickyPattern.lastIndex); // 7

// æ‰‹åŠ¨ä¿®æ”¹ä¸‹æ­£åˆ™è¡¨è¾¾å¼çš„ lastIndex å±æ€§ï¼Œæµ‹è¯•ä¸€ä¸‹ sticky å±æ€§å½±å“
// lastIndex ä¸º 1ï¼Œæ‰€ä»¥ä»ç¬¬äºŒä¸ªå­—ç¬¦ â€œeâ€ å¼€å§‹åŒ¹é…
pattern.lastIndex = 1; // æ²¡æœ‰ä¿®é¥°ç¬¦ï¼Œæ¯æ¬¡åŒ¹é…éƒ½æ˜¯ä»å¤´å¼€å§‹ï¼ŒlastIndex ç›´æ¥è¢«å¿½ç•¥
globalPattern.lastIndex = 1;
stickyPattern.lastIndex = 1;

result = pattern.exec(text);
globalResult = globalPattern.exec(text);
stickyResult = stickyPattern.exec(text); // ä½¿ç”¨äº† y ä¿®é¥°ç¬¦çš„ç²˜æ»

console.log(result[0]); // "hello1 "
console.log(globalResult[0]); // "hello2 "
console.log(stickyResult[0]); // æŠ›å‡ºé”™è¯¯ï¼š Cannot read property '0' of null

// æŠ¥é”™ä¸­æ–­åï¼Œå†æ¬¡çš„æ‰§è¡Œä¸‹é¢ä»£ç 
stickyResult = stickyPattern.exec(text);
console.log(stickyResult[0]); // "hello1 "
```

`y` ä¿®é¥°ç¬¦ä¼šæŠŠä¸Šæ¬¡åŒ¹é…åé¢ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ä¿å­˜åœ¨ `lastIndex` ä¸­ï¼›å¦‚æœè¯¥æ“ä½œåŒ¹é…çš„ç»“æœä¸ºç©ºï¼Œåˆ™ `lastIndex` ä¼šè¢«é‡ç½®ä¸º `0` ã€‚`g` ä¿®é¥°ç¬¦çš„è¡Œä¸ºä¸æ­¤ç›¸åŒã€‚

##### æ³¨æ„äº‹é¡¹

**y ä¿®é¥°ç¬¦**

1. åªæœ‰è°ƒç”¨ `exec()` å’Œ `test()` è¿™äº›æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ–¹æ³•æ—¶æ‰ä¼šæ¶‰åŠ `lastIndex` å±æ€§ï¼›è°ƒç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `macth()` åˆ™ä¸ä¼šè§¦å‘ç²˜æ»è¡Œä¸ºã€‚
2. å¯¹äºç²˜æ»æ­£åˆ™è¡¨è¾¾å¼è€Œè¨€ï¼Œå¦‚æœä½¿ç”¨ `^` å­—ç¬¦ æ¥åŒ¹é…å­—ç¬¦ä¸²å¼€ç«¯ï¼Œåªä¼šä»å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®æˆ–å¤šè¡Œæ¨¡å¼çš„é¦–è¡Œè¿›è¡ŒåŒ¹é…ã€‚å½“ `lastIndex` çš„å€¼ä¸º 0 æ—¶ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼ä¸­å«æœ‰ `^` ï¼Œåˆ™æ˜¯å¦ä½¿ç”¨ç²˜æ»æ­£åˆ™è¡¨è¾¾å¼å¹¶æ— å·®åˆ«ï¼›å¦‚æœ `lastIndex` çš„å€¼åœ¨å•è¡Œæ¨¡å¼ä¸‹ä¸ä¸º 0ï¼Œæˆ–åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ä¸å¯¹åº”è¡Œé¦–ï¼Œåˆ™ç²˜æ»çš„è¡¨è¾¾å¼æ°¸è¿œä¸ä¼šåŒ¹é…æˆåŠŸã€‚

##### æ£€æµ‹ y ä¿®é¥°ç¬¦æ˜¯å¦å­˜åœ¨

é€šè¿‡å±æ€§åæ¥è¿›è¡Œæ£€æµ‹ï¼Œ æ£€æµ‹æ­£åˆ™è¡¨è¾¾å¼ `sticky`  ç²˜æ»å±æ€§æ˜¯å¦æ”¯æŒã€‚

```javascript
const pattern = /hello\d/y;
console.log(pattern.sticky); // true
```

å¦‚æœæµè§ˆå™¨å¼•æ“æ”¯æŒç²˜æ»ä¿®é¥°ç¬¦ï¼Œåˆ™ `sticky` å±æ€§å€¼ä¸º `true`, å¦åˆ™ä¸º `false`ã€‚è¿™ä¸ªæ˜¯åªè¯»å±æ€§ã€‚

##### æ£€æµ‹å¼•æ“å¯¹å®ƒçš„æ”¯æŒç¨‹åº¦

æ£€æµ‹æµè§ˆå™¨å¼•æ“å¯¹ `y` ä¿®é¥°ç¬¦å’Œ  `u` ä¿®é¥°ç¬¦çš„æ”¯æŒç¨‹åº¦ï¼Œä¸¤ç§æ–¹å¼éƒ½æ˜¯é€šè¿‡ `RegExp` æ„é€ å‡½æ•°æ¥è¿›è¡Œï¼ˆè§„é¿è¯­æ³•é”™è¯¯ï¼‰ï¼š

```JavaScript
function hasRegExpY() {
  try {
    var parrent = new RegExp(".", "y");
    return true;
  } catch (ex) {
    return false;
  }
}
```

#### æ­£åˆ™è¡¨è¾¾å¼çš„å¤åˆ¶

å¯¹äºæ­£åˆ™è¡¨è¾¾å¼çš„å¤åˆ¶ï¼Œå°±æ˜¯é€šè¿‡ `RegExp` çš„æ„é€ å‡½æ•°ä¼ é€’æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºå‚æ•°æ¥å¤åˆ¶è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚

è¿™ç§æ–¹å¼çš„å¤åˆ¶åœ¨ `ECMAScript 5` å’Œ `ECMAScript 6` æœ‰ä¸€ä¸ªåŒºåˆ«ï¼š

* åœ¨ `ECMAScript 5` ä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œä¸èƒ½ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯
* `ECMAScript 6` ç¯å¢ƒä¸‹ï¼Œæ­£å¸¸è¿è¡Œï¼Œä¹Ÿæ”¯æŒäº†ä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿®é¥°ç¬¦ã€‚

```javascript
// å¤åˆ¶æ–¹å¼
var re1 = /ab/i,
    re2 = new RegExp(re1);

// ES5 ä¸­ä¼šæŠ›å‡ºé”™è¯¯, ES6 æ”¯æŒ
re3 = new RegExp(re1, 'g');
console.log(re3.toString()); // "/ab/g"
```

#### flags å±æ€§ï¼ˆES6ï¼‰

è·å–æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ã€‚

ES5 çš„æ—¶å€™è·å–æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ï¼Œåªèƒ½é€šè¿‡ `toString` çš„æ–¹æ³•æ¥è¿›è¡Œï¼š

```javascript
function getFlags (reg) {
  var text = reg.toString();
  return text.substring(text.lastIndexOf('/') + 1, text.length);
}

// æ–¹å¼äºŒï¼ˆæ›¿æ¢æˆªå–æ–¹æ³•ï¼‰
function getFlags(reg) {
  var text = reg.toString();
  return text.slice(text.lastIndexOf('/') + 1);
}

const pattern = /hello\d/y;
console.log(pattern.source) // "hello\d"
console.log(getFlags(pattern)); // "y"
```

ES6 æ–°å¢ **flags** å±æ€§ï¼š

```javascript
const pattern = /hello\d/y;
console.log(pattern.flags); // "y"
```

### æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆæ¨¡æ¿å­—é¢é‡ï¼‰

**ECMAScript 6** æ¨¡æ¿å­—é¢é‡è¯­æ³•ç³–æ”¯æŒåˆ›å»ºé¢†åŸŸä¸“ç”¨è¯­è¨€ï¼ˆDSLï¼‰,æ‰©å±• `ECMAScript` åŸºç¡€è¯­æ³•ç³–ï¼Œå…¶æä¾›ä¸€å¥—ç”Ÿæˆã€æŸ¥è¯¢å¹¶æ“ä½œæ¥è‡ªå…¶ä»–è¯­è¨€é‡Œå†…å®¹çš„ DSLï¼Œä¸”å¯ä»¥å…å—æ³¨å…¥æ”»å‡»ï¼Œä¾‹å¦‚ï¼ŒXSSã€SQL æ³¨å…¥ç­‰ã€‚

> **é¢†åŸŸç‰¹å®šè¯­è¨€**ï¼ˆè‹±è¯­ï¼šdomain-specific languageã€DSLï¼‰
>
> æŒ‡çš„æ˜¯ä¸“æ³¨äºæŸä¸ª[åº”ç”¨ç¨‹åº](https://baike.baidu.com/item/åº”ç”¨ç¨‹åº/5985445)é¢†åŸŸçš„[è®¡ç®—æœºè¯­è¨€](https://baike.baidu.com/item/è®¡ç®—æœºè¯­è¨€/4456504)ã€‚åˆè¯‘ä½œ**é¢†åŸŸä¸“ç”¨è¯­è¨€**ã€‚ä¸åŒäºæ™®é€šçš„è·¨é¢†åŸŸé€šç”¨è®¡ç®—æœºè¯­è¨€(GPL)ï¼Œé¢†åŸŸç‰¹å®šè¯­è¨€åªç”¨åœ¨æŸäº›ç‰¹å®šçš„é¢†åŸŸã€‚ æ¯”å¦‚ç”¨æ¥æ˜¾ç¤ºç½‘é¡µçš„[HTML](https://baike.baidu.com/item/HTML)ï¼Œä»¥åŠ[Emacs](https://baike.baidu.com/item/Emacs)æ‰€ä½¿ç”¨çš„Emac LISPè¯­è¨€ã€‚

ç›¸å¯¹äº **ECMAScript 5** ï¼Œæ¨¡æ¿å­—é¢é‡æ”¯æŒäº†ï¼š

* å¤šè¡Œå­—ç¬¦ä¸²
* åŸºæœ¬çš„å­—ç¬¦ä¸²æ ¼å¼åŒ– ï¼ˆå°†å˜é‡çš„å€¼åµŒå…¥å­—ç¬¦ä¸²çš„èƒ½åŠ›ï¼‰
* HTML è½¬ä¹‰

```javascript
const firstName = `Junting`;
const lastName = 'Liu';
const str = `My first name is ${firstName},
last name is ${lastName}.`;

console.log(str);
// My first name is Junting,
// last name is Liu.
```

#### æ ‡ç­¾æ¨¡æ¿

```javascript
let message = tag`hello world!`;
```

`tag` å°±æ˜¯æ ‡ç­¾æ¨¡æ¿é‡Œçš„**æ¨¡æ¿æ ‡ç­¾**ã€‚æ¯ä¸ªæ¨¡æ¿æ ‡ç­¾éƒ½å¯ä»¥æ‰§è¡Œæ¨¡æ¿å­—é¢é‡ä¸Šçš„è½¬æ¢å¹¶è¿”å›æœ€ç»ˆçš„å­—ç¬¦ä¸²ã€‚

æ ‡ç­¾å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨æ—¶ä¼ å…¥åŠ å·¥è¿‡çš„æ¨¡æ¿å­—é¢é‡å„ä¸ªéƒ¨åˆ†æ•°æ®ï¼Œä½†å¿…é¡»ç»“åˆæ¯ä¸ªéƒ¨åˆ†æ¥åˆ›å»ºç»“æœã€‚

* ç¬¬ä¸€å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å« Javascript è§£é‡Šè¿‡åçš„å­—é¢é‡å­—ç¬¦ä¸²
* åé¢çš„æ¯ä¸€ä¸ªå‚æ•°éƒ½æ˜¯æ¯ä¸€ä¸ªå ä½ç¬¦çš„è§£é‡Šå€¼ã€‚

```javascript
function tag (literals, ...substitutions) {
  // è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
}
```

> **literals** ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œç¡®ä¿å­—ç¬¦ä¸²å§‹ç«¯ã€‚
>
> **substitutions** å‚æ•°çš„æ•°é‡æ°¸è¿œä¹Ÿæ¯” **literals** å°‘ä¸€ä¸ªã€‚`substitutions.length === literals.length - 1` ç»“æœæ€»ä¸º `true`

**ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å­—é¢é‡è½¬æ¢é»˜è®¤è¡Œä¸ºçš„å‡½æ•°**

```javascript
const count = 10,
      price = 2.5,
      message = passthru`${count} items cost $${(count * price).toFixed(2)}.`;

function passthru (literals, ...substitutions) {
  console.log(literals); // ["", " items cost $", ".", raw: Array(3)]
  console.log(substitutions); // [10, "25.00"]
  let result = '';

  for (let i = 0; i < substitutions.length; i++) {
    result += literals[i];
    result += substitutions[i];
  }
  result += literals[literals.length - 1];
  return result;
}

console.log(message); // "10 items cost $25.00."
```

æ ‡ç­¾æ¨¡æ¿çš„æ ‡ç­¾( Tag ) çš„èŒè´£å°±æ˜¯å¤„ç†å­—ç¬¦ä¸²æœ€åæ€æ ·è¿”å›ç»“æœï¼Œç”±æ ‡ç­¾æ¥å®šã€‚

#### è·å–æ¨¡æ¿å­—é¢é‡çš„åŸå§‹å€¼

`String.raw()` æå–åŸç”Ÿå­—ç¬¦ä¸²ä¿¡æ¯ï¼Œæå–è½¬ä¹‰æˆ–è½¬æ¢å‰çš„åŸç”Ÿå­—ç¬¦ä¸²ã€‚

```javascript
let message1 = `Multiline\nstring`,
    message2 = String.raw`Multiline\nstring`;

console.log(message1); // "Multiline"
											 // "string"
console.log(message2); // "Multiline\nstring" (Browser)
											 // "Multiline\\nstring" (Node)
```

> ä¸Šä¸ªç¤ºä¾‹ä¸­ï¼Œæ ‡ç­¾å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ•°ç»„è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å±æ€§ **raw**, æ˜¯ä¸€ä¸ªåŒ…å«æ¯ä¸€ä¸ªå­—é¢å€¼çš„åŸç”Ÿç­‰ä»·ä¿¡æ¯çš„æ•°ç»„ã€‚
